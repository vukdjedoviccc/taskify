version: '3.8'

services:
  db:
    image: mcr.microsoft.com/mssql/server:2019-latest
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=${DB_PASSWORD}
      - MSSQL_PID=Express
    ports:
      - "1433:1433"
    volumes:
      - db-data:/var/opt/mssql

  backend:
    build: ./server
    ports:
      - "8081:8081"
    environment:
      - NODE_ENV=production
      - PORT=8081
      - DATABASE_URL=sqlserver://db:1433;database=taskify;user=sa;password=${DB_PASSWORD};encrypt=true;trustServerCertificate=true
      - JWT_SECRET=${JWT_SECRET}
      - JWT_EXPIRES_IN=7d
      - COOKIE_NAME=taskify_token
      - CORS_ORIGIN=http://localhost
      - FRONTEND_URL=http://localhost
    depends_on:
      - db

  frontend:
    build: ./client
    ports:
      - "80:80"
    depends_on:
      - backend

volumes:
  db-data:
